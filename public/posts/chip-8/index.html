<!DOCTYPE html>
<html lang="en-us" data-theme="light">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>How to: Write a Basic CHIP-8 Emulator | srikur&#39;s dev page</title>

<link rel="stylesheet" href="https://srikur.github.io//css/styles.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" 
integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>


<div class="container">
    <nav class="navbar level">
      <div class="navbar-brand">
          <a class="nav-item" href="https://srikur.github.io/"><h1 class="title is-3">srikur&#39;s dev page</h1></a>
      </div>           
      <div class="navbar-menu has-text-centered is-active">
          <div class="navbar-end is-centered">
              
                <a href="https://srikur.github.io/about.html" rel="me">
                  <span class="icon">
                    <i class="fas fa-info"></i>
                  </span>
                </a>
              
                <a href="https://github.com/srikur" rel="me">
                  <span class="icon">
                    <i class="fab fa-github"></i>
                  </span>
                </a>
              
                <a href="https://www.linkedin.com/in/srikurk/" rel="me">
                  <span class="icon">
                    <i class="fab fa-linkedin-in"></i>
                  </span>
                </a>
              
                <a href="https://twitter.com/srikurk" rel="me">
                  <span class="icon">
                    <i class="fab fa-twitter"></i>
                  </span>
                </a>
              
           </div>
      </div>
    </nav>
  </div>

<div class="container">
  <h2 class="subtitle is-6">July 25, 2024</h2>
  <h1 class="subtitle is-size-4-mobile is-size-3-desktop">How to: Write a Basic CHIP-8 Emulator</h1>
  <div class="content">
    <p>NOTE: Unfinished</p>
<h1 id="introduction">Introduction</h1>
<p>To condense the plan into one sentence, our goal is to emulate the functionality of a game system programmatically by having an endless loop where we fetch low level instructions from ROMs (i.e. game cartridge binary dumps), execute those instructions, and repeat, updating the screen graphics as necessary. This is exactly what the real consoles due at the hardware level.</p>
<p>Our road to becoming qualififed emulator developers begins with the CHIP-8. In the 1970s, Joseph Weisbecker developed CHIP-8 as an interpreted programming language for use on a couple of 8-bit microcomputers. The reason that we are going to start our emulator development journey by building the CHIP-8 virtual machine is that it will introduce the concepts needed for the more compicated systems. It&rsquo;s also very feasible to get it running on day one if you dedicate some focused hours to it.</p>
<h1 id="system-specification">System Specification</h1>
<p>Let&rsquo;s quickly go over the tehcnical aspects of the CHIP-8 system. Check out <a href="http://devernay.free.fr/hacks/chip8/C8TECH10.HTM">this</a> link for far nore details if you&rsquo;re interested.</p>
<h2 id="memory">Memory</h2>
<p>The CHIP-8 has 4096 bytes of memory, which is <code>0xFFF</code> in hexadecimal. However, CHIP-8 programs dont address their memory before <code>0x200</code>, the first 512 bytes. That first half-kilobyte used to be where the interpreter was stored, but we don&rsquo;t need to do anything about that. Instead, we will load the <strong>fonts</strong> (more details below) into that first section and then load the ROM&rsquo;s data starting at <code>0x200</code>.</p>
<h2 id="instructions">Instructions</h2>
<p>All CHIP-8 instructions are two bytes, meaning we will read them as is into a 16-bit integer into the <strong>program counter</strong>, with minimum and maximum values of <code>0x0000</code> and <code>0xFFFF</code>, respectively. However, as you&rsquo;ll see when we get into the actual instructions and their values, the actual domain of possible values is much more limited.</p>
<h2 id="registers">Registers</h2>
<p>There are 16 general purpose 8-bit registers called <code>V0</code> through <code>VF</code> (i.e. <code>V15</code>), along with a single 16-bit <em>index</em> register. This index register will be used to point to locations in memory, which a program might access for whatever reason it needs. The register <code>VF</code> is also referred to as the <em>flag</em> register, since it&rsquo;s value been set or not set (i.e. 1 or 0) is used by programs to know when certain conditions are met. You&rsquo;ll understand what I mean by this when we get into the actual implementation of the instructions.</p>
<p>Of course, there is also the 16-bit <strong>program counter</strong>, which points to a location in the memory from which we should read our next instruction, the subsequent two bytes.</p>
<h2 id="input">Input</h2>
<p>The computers than originally ran the CHIP-8 interpreter had 16 keys, from 0-F, arranged like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>+---------+
</span></span><span style="display:flex;"><span>| 1 2 3 C |
</span></span><span style="display:flex;"><span>| 4 5 6 D |
</span></span><span style="display:flex;"><span>| 7 8 9 E |
</span></span><span style="display:flex;"><span>| A 0 B F |
</span></span><span style="display:flex;"><span>+---------+
</span></span></code></pre></div><p>Since modern computer keyboards have far more keys, you can choose what 16 keys you want to map those to. It should probably be keys that are in a 4x4 grid so it aligns with the layout of the original.</p>
<h2 id="graphics">Graphics</h2>
<p>The screen size for CHIP08 systems is 64x32 pixels, for a total of 2048, or <code>0x148</code>. So, you can have a 2-dimensional array if you want, but you can also simply represent this as a 1-dimensional array and accessing the element at the coordinates (x,y) using <code>y * 64 + x</code>. When it comes to rendering, I&rsquo;ve opted for the solution of creating a texture from the pixel array, and then rendering the texture.</p>
<h2 id="fonts">Fonts</h2>
<p>The CHIP-8 memory has fifteen preloaded sprites, which are representations of the hexadecimal digits 0-F. Each one is 4 x 5 pixels, so we can represent each as 5 bytes as such:</p>
<table>
  <thead>
      <tr>
          <th>Sprite</th>
          <th>Values</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>0</td>
          <td><code>0xF0</code> <code>0x90</code> <code>0x90</code> <code>0x90</code> <code>0xF0</code></td>
      </tr>
      <tr>
          <td>1</td>
          <td><code>0x20</code> <code>0x60</code> <code>0x20</code> <code>0x20</code> <code>0x70</code></td>
      </tr>
      <tr>
          <td>2</td>
          <td><code>0xF0</code> <code>0x10</code> <code>0xF0</code> <code>0x80</code> <code>0xF0</code></td>
      </tr>
      <tr>
          <td>3</td>
          <td><code>0xF0</code> <code>0x10</code> <code>0xF0</code> <code>0x10</code> <code>0xF0</code></td>
      </tr>
      <tr>
          <td>4</td>
          <td><code>0x90</code> <code>0x90</code> <code>0xF0</code> <code>0x10</code> <code>0x10</code></td>
      </tr>
      <tr>
          <td>5</td>
          <td><code>0xF0</code> <code>0x80</code> <code>0xF0</code> <code>0x10</code> <code>0xF0</code></td>
      </tr>
      <tr>
          <td>6</td>
          <td><code>0xF0</code> <code>0x80</code> <code>0xF0</code> <code>0x90</code> <code>0xF0</code></td>
      </tr>
      <tr>
          <td>7</td>
          <td><code>0xF0</code> <code>0x10</code> <code>0x20</code> <code>0x40</code> <code>0x40</code></td>
      </tr>
      <tr>
          <td>8</td>
          <td><code>0xF0</code> <code>0x90</code> <code>0xF0</code> <code>0x90</code> <code>0xF0</code></td>
      </tr>
      <tr>
          <td>9</td>
          <td><code>0xF0</code> <code>0x90</code> <code>0xF0</code> <code>0x10</code> <code>0xF0</code></td>
      </tr>
      <tr>
          <td>A</td>
          <td><code>0xF0</code> <code>0x90</code> <code>0xF0</code> <code>0x90</code> <code>0x90</code></td>
      </tr>
      <tr>
          <td>B</td>
          <td><code>0xE0</code> <code>0x90</code> <code>0xE0</code> <code>0x90</code> <code>0xE0</code></td>
      </tr>
      <tr>
          <td>C</td>
          <td><code>0xF0</code> <code>0x80</code> <code>0x80</code> <code>0x80</code> <code>0xF0</code></td>
      </tr>
      <tr>
          <td>D</td>
          <td><code>0xE0</code> <code>0x90</code> <code>0x90</code> <code>0x90</code> <code>0xE0</code></td>
      </tr>
      <tr>
          <td>E</td>
          <td><code>0xF0</code> <code>0x80</code> <code>0xF0</code> <code>0x80</code> <code>0xF0</code></td>
      </tr>
      <tr>
          <td>F</td>
          <td><code>0xF0</code> <code>0x80</code> <code>0xF0</code> <code>0x80</code> <code>0x80</code></td>
      </tr>
  </tbody>
</table>
<p>You should probably have a static array in your emulator so that you can quickly preload them into the system&rsquo;s memory at runtime.</p>
<h1 id="setup">Setup</h1>
<p>Alright, we&rsquo;re almost ready to do some programming, but first we need to decide what tools we&rsquo;re going to use. In other words, we need to choose a programming language and graphics library. If you&rsquo;re up for the challenge, I recommend trying something new - I usually try to do each new project in a new programming language. For this tutorial, I&rsquo;m trying to provide a complete guide, so I&rsquo;ll be detailing code and guidance in four languages: C++, Python, Java,and Swift. If you&rsquo;re not an experienced programmer, I suggest you start in Python, as it&rsquo;ll probably have the lowest learning curve.</p>
<h2 id="folder-structure-graphics-and-implementation">Folder Structure, Graphics, and Implementation</h2>
<p>There&rsquo;s a number of graphics libraries you can use to render your emulator, but I recommend using <a href="https://www.libsdl.org/">SDL</a> if you&rsquo;re developing for Windows and use <a href="https://developer.apple.com/spritekit/">SpriteKit</a> if you&rsquo;re developing for macOS/iOS. Although SDL is a C library, there are bindings for tons of languages out there. I encourage you to determine what folder and file structure works best for you by yourself, as it&rsquo;ll also help you think about abstractions you can make in your code.</p>
<h2 id="the-main-loop">The Main Loop</h2>
<p>In order to read instructions from ROMs sequentially, we need to have a loop that runs endlessly &ndash; or at least until we tell the program to quit in some way. All you need is a simple loop that will execute the CPU of our emulator (at a specific frame rate), polling keyboard events and drawing updates to the screen if necessary along the way. The basic skeleton looks something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">while</span> <span style="color:#bc74c4">not</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>quit<span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># Poll Events</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># Emulate CPU cycle(s)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># Render the screen</span>
</span></span></code></pre></div><p>Here, <code>self.quit</code> is just a boolean flag for whether or not we should exit the loop and run the cleanup code before ending the program altogether.</p>
<h2 id="the-cpu-class-and-its-members">The CPU Class and its Members</h2>
<p>Okay, let&rsquo;s now get into actually building our emulator. As I dicussed in the Specifications section, there are several components of the system that we have to recreate; since the CHIP-8 structure is very simple, it suffices to keep everything as variables in a <code>CPU</code> class. We&rsquo;ll need more abstraction and encapsulation for more complicated emulators later. The variables we&rsquo;ll create are:</p>
<ul>
<li>Memory: We need 4KB of RAM, which can be a regular array.</li>
<li>Program Counter (<code>PC</code>): This can be a single byte, pointing to wherever the next instruction needs to be read from.</li>
<li>Index Register (<code>I</code>): This is a 16-bit (2 byte) value, but since there only 4KB of RAM, it&rsquo;ll only ever have a maximum of 4095, which happens to be the maximum 12-bit unsigned decimal value.</li>
<li>Stack: The CHIP-8 specification needs to support up to 12 subroutine calls, but unless you&rsquo;re somehow reading this half a century before it was written, that&rsquo;s never going to be an issue on modern computers. There are a few ways to go about implementing this, but we&rsquo;re going to have it as an array of 16-bit numbers along with a 16-bit variable called the <strong>stack pointer</strong> that will keep track of where we are in the array.</li>
<li>Delay Timer: 8-bit value that decreases from its maximum of <code>0xFF</code> to <code>0x00</code> at a rate of 60 times per second (once we get the timing right).</li>
<li>Sound Timer: 8-bit value that controls the single beeping sound supported by CHIP-8, which is emitted whenever the sound timer is <code>0x02</code> or higher, and counts down like the Delay Timer.</li>
<li>Registers: These are 8-bit general-purpose registers that do the actual heavy lifting of the computation. They are labeled <code>V0</code> through <code>VF</code> (15 in hexadecimal), so we can emulate them using a one byte array of length 16.</li>
<li>Display: The display for the CHIP-8 is monochrome and is 64 x 32 pixels, which means that every pixel is either <code>0x00</code> or <code>0x01</code>. We can represent this as a 1-dimensional array. It would make sense for this to be in the <code>Emulator</code> class rather than the <code>CPU</code> class, but we&rsquo;ll need to modify it using instructions, so this makes life a little easier.</li>
</ul>
<p>Here&rsquo;s the CPU class definitions. You can ignore any of the variables I haven&rsquo;t explained yet for now. I&rsquo;ll cover them when we get to where they&rsquo;re actually used.</p>
<h2 id="starting-out">Starting Out</h2>
<p>The section after this has descriptions and code for the complete instruction set, but rather than try to do them all in one go, you should start off with the following five:</p>
<ul>
<li><code>00E0</code> (clearing the screen)</li>
<li><code>1NNN</code> (jumping to address <code>NNN</code>)</li>
<li><code>6XNN</code> (set register <code>X</code> to value <code>NN</code>)</li>
<li><code>ANNN</code> (set index register to value <code>NNN</code>)</li>
<li><code>DXYN</code> (draw a sprite at (<code>X</code>,<code>Y</code>))</li>
</ul>
<p>These five are used in Timendus&rsquo; CHIP-8 splash screen logo test ROM. You can find that one along with a bunch of other test ROMs <a href="https://github.com/Timendus/chip8-test-suite">here</a>. As noted in that GitHub repo, the original IBM test logo requires an additional instruction, <code>7XNN</code>. After those two work properly, you can start using the test ROMs that test a lot more functionality.</p>
<h2 id="the-instruction-set">The Instruction Set</h2>
<p>All the setup is finally done, and we&rsquo;re ready to actually create the logic behind the emulator. As you know, the CHIP-8 ROMs are being read in as bytes, and each instruction is 2 bytes long. Each instruction does specific tasks with the registers, display, or program counter, so one way to write that functionality is to have a <code>switch</code> statement (or your language&rsquo;s equivalent) that decodes the instruction and executes the relevant code. Another, fancier way is to use function pointers with some logic like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#3e4460">/* Fetch opcode */</span>
</span></span><span style="display:flex;"><span>instruction <span style="color:#bc74c4">=</span> memory<span style="color:#56b6c2">[</span>pc<span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&lt;&lt;</span> <span style="color:#56b6c2">8</span> <span style="color:#bc74c4">|</span> memory<span style="color:#56b6c2">[</span>pc <span style="color:#bc74c4">+</span> <span style="color:#56b6c2">1</span><span style="color:#56b6c2">];</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3e4460">/* Find the right spot in the table */</span>
</span></span><span style="display:flex;"><span><span style="color:#57c7ff;font-weight:bold">void</span><span style="color:#56b6c2">(</span>CHIP8<span style="color:#bc74c4">::</span> <span style="color:#bc74c4">*</span> opcode_fn<span style="color:#56b6c2">)()</span> <span style="color:#bc74c4">=</span> Chip8Table<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xF000</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">12</span><span style="color:#56b6c2">];</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3e4460">/* Execute the relevant function */</span>
</span></span><span style="display:flex;"><span><span style="color:#56b6c2">(</span><span style="color:#7fbaf5">this</span><span style="color:#bc74c4">-&gt;*</span>opcode_fn<span style="color:#56b6c2">)();</span>
</span></span></code></pre></div><p>But this is not necessary at all, and might be slower than a simple <code>switch</code>. Let&rsquo;s now go through each of the 35 instructions supported by CHIP-8 and see how we can write them. The <a href="https://github.com/mattmikolay/chip-8/wiki/CHIP%E2%80%908-Technical-Reference">CHIP-8 Technical Reference</a> GitHub wiki by Matthew Mikolay has all the instructions with descriptions. That repository also has a lot more technical information about the CHIP-8 interpreter than I have provided here, so check it out if there&rsquo;s something you think is missing.</p>
<p>For our switch statement, we&rsquo;ll match the cases with <code>instruction &amp; 0xF000</code>, which will let us match the most significant digit for the instructions that have <code>N</code> in them.</p>
<h3 id="0nnn"><code>0NNN</code></h3>
<p>Good news! We don&rsquo;t need to implement this one, since it was designed to execute subroutines on the 1802 microprocessor.</p>
<h3 id="00e0-and-00ee"><code>00E0</code> and <code>00EE</code></h3>
<p><code>00E0</code> clears the screen, making all the pixels zero. We can do this in a single line.
<code>00EE</code> returns from a subroutine. Remember that we use the the stack to keep track of subroutine calls, so returning from one means decreasing the stack pointer. We&rsquo;ll see how to call a subroutine in a second.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">if</span> instruction <span style="color:#bc74c4">==</span> <span style="color:#57c7ff">0x00E0</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3e4460"># 0E00: Clear the screen. Set all pixels to 0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>screen <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">[</span><span style="color:#56b6c2">0</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">*</span> <span style="color:#57c7ff">0x800</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">elif</span> instruction <span style="color:#bc74c4">==</span> <span style="color:#57c7ff">0x00EE</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#3e4460"># 00EE: Return from a subroutine. Set the program counter to the address at the top of the stack</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>stack_pointer <span style="color:#bc74c4">-=</span> <span style="color:#56b6c2">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>program_counter <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>stack<span style="color:#56b6c2">[</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>stack_pointer<span style="color:#56b6c2">]</span>
</span></span></code></pre></div><h3 id="1nnn"><code>1NNN</code></h3>
<p>This instruction &ldquo;jumps&rdquo; to value located at the memory location <code>NNN</code>. Remember, the logical <code>AND</code> will return 0 if either of the bits being compared is zero. What we&rsquo;re doing here is using the value <code>0x0FFF</code> to <em>mask</em> the lower 12 bits of the instruction&rsquo;s value. Since leading zeroes don&rsquo;t matter in binary, this leaves with just <code>NNN</code>. Also note that the only thing we need to do to make this jump is set the program counter, since that is what loads the subsequent instruction to be executed.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x1000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># 1NNN: Jump to address NNN</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>program_counter <span style="color:#bc74c4">=</span> instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0FFF</span>
</span></span></code></pre></div><h3 id="2nnn"><code>2NNN</code></h3>
<p>Like the previous <code>1NNN</code>, this instruction sets the PC to the lower 12 bits of the instruction. However, since its purpose is to call a subroutine, we need to push the pre-call instruction location onto the stack. This will allow us to <em>pop</em> the value off the stack when its time to return from the subroutine. You don&rsquo;t really need to worry about the stack pointer overflowing if you&rsquo;ve correctly implement all the instructions. In fact, if your program crashes due to trying to access an index beyond the size of the stack, you&rsquo;ll know that either this instruction or some other one is incorrect.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x2000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># 2NNN: Call subroutine at NNN. We place the current program counter on the stack so we can return to it later when returning from the subroutine</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>stack<span style="color:#56b6c2">[</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>stack_pointer<span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>program_counter
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>stack_pointer <span style="color:#bc74c4">+=</span> <span style="color:#56b6c2">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>program_counter <span style="color:#bc74c4">=</span> instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0FFF</span>
</span></span></code></pre></div><h3 id="3xnn"><code>3XNN</code></h3>
<p><code>3XNN</code> is the first instruction that&rsquo;s a little different. It skips the next instruction if <code>X</code> does not equal <code>NN</code>. Let&rsquo;s break down both sides of the <code>if</code> statement, since their structure will come up in practically every instruction from here on out.</p>
<p>On the left hand side we have <code>self.registers[(instruction &amp; 0x0F00) &gt;&gt; 8]</code>. Here what we&rsquo;re doing is using a bitmask <code>AND</code> to get the second nibble from the instruction, giving us <code>X00</code>. Then we right shift it by 8 bits &ndash; what this does is essentially discard the lowest two nibbles of <code>X00</code> and gets it to just <code>X</code> (remember the leading zeroes don&rsquo;t count, only the trailing ones do). Now, we can index the registers array, since we want to compare the value of register <code>X</code> to <code>NN</code>.</p>
<p>As you now know, to do that we take <code>instruction &amp; 0x00FF</code>, which gives us just the lower byte of the instruction, and compare it to the left hand side. Since we increment the program counter by 2 in the fetch-decode-execute loop, skipping an instruction involves adding another 2 to the PC.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x3000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># 3XNN: Skip the next instruction if register X equals NN</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">if</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">==</span> instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00FF</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>program_counter <span style="color:#bc74c4">+=</span> <span style="color:#56b6c2">2</span>
</span></span></code></pre></div><h3 id="4xnn"><code>4XNN</code></h3>
<p>This is pretty much the same as the previous instruction, but remember to use <code>!=</code> instead of <code>==</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x4000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># 4XNN: Skip the next instruction if register X does not equal NN</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">if</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">!=</span> instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00FF</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>program_counter <span style="color:#bc74c4">+=</span> <span style="color:#56b6c2">2</span>
</span></span></code></pre></div><h3 id="5xy0"><code>5XY0</code></h3>
<p>Like the previous two instructions, we are adding additional amounts to the PC if a certain condition is met. However, this time we&rsquo;re comparing the values of two registers. Register <code>X</code> we obtain like before, by using a bitmask and then shifting the value 8 bits to the right. For register <code>Y</code>, we do the same, but using <code>0x00F0</code> and shifting right by 4 bits instead, as the location of <code>Y</code> in the instruction is one nibble to the right.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x5000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># 5XY0: Skip the next instruction if register X equals register Y</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">if</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">==</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00F0</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">4</span><span style="color:#56b6c2">]:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>program_counter <span style="color:#bc74c4">+=</span> <span style="color:#56b6c2">2</span>
</span></span></code></pre></div><h3 id="6xnn"><code>6XNN</code></h3>
<p>You should have no problem interpreting this one now. We are simply setting the value of the register at <code>X</code> to be <code>NN</code>, extracting those two values in the standard way.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x6000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># 6XNN: Set register X to NN</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00FF</span>
</span></span></code></pre></div><h3 id="7xnn"><code>7XNN</code></h3>
<p>The same as <code>6XNN</code>, but we are adding the value of <code>NN</code> to the previous value contained in register <code>X</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x7000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># 7XNN: Add NN to register X</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">+=</span> instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00FF</span>
</span></span></code></pre></div><h3 id="8xy0---8xy7-and-8xye"><code>8XY0</code> - <code>8XY7</code> and <code>8XYE</code></h3>
<p>These are some arithmetic instructions. Note that in the Python code for some of the intermediate calculations, we need to include <code>&amp; 0xFF</code> before using them. The reason is because we&rsquo;re simulating 8-bit or 16-bit unsigned integers using the regular signed integer datatype that Python has, so we run the risk of not properly overflowing those integer values as they would in a regular 8-bit unsigned value. To fix that, we simply take the lowest byte of the integer before doing any further calculations with a value. If you&rsquo;re using a language that has built in unsigned bytes, like <code>uint8_t</code> in C/C++, you don&rsquo;t need to worry about that.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x8000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">match</span> instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x000F</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># 8XY0: Set register X to the value of register Y</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00F0</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">4</span><span style="color:#56b6c2">]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0001</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># 8XY1: Set register X to the value of register X OR register Y</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">|=</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00F0</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">4</span><span style="color:#56b6c2">])</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0002</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># 8XY2: Set register X to the value of register X AND register Y</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;=</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00F0</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">4</span><span style="color:#56b6c2">])</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0003</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># 8XY3: Set register X to the value of register X XOR register Y</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">^=</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00F0</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">4</span><span style="color:#56b6c2">])</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0004</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># 8XY4: Add the value of register Y to register X. Set VF to 1 if there is a carry, 0 otherwise</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span><span style="color:#56b6c2">)</span> \
</span></span><span style="display:flex;"><span>                                                        <span style="color:#bc74c4">+</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00F0</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">4</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span><span style="color:#56b6c2">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">if</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&gt;</span> <span style="color:#57c7ff">0xFF</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[</span><span style="color:#57c7ff">0xF</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">else</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[</span><span style="color:#57c7ff">0xF</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">0</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;=</span> <span style="color:#57c7ff">0xFF</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0005</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># 8XY5: Subtract the value of register Y from register X. Set VF to 0 if there is a borrow, 1 otherwise</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span><span style="color:#56b6c2">)</span> \
</span></span><span style="display:flex;"><span>                                                        <span style="color:#bc74c4">-</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00F0</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">4</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span><span style="color:#56b6c2">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">if</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&lt;</span> <span style="color:#56b6c2">0</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[</span><span style="color:#57c7ff">0xF</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">0</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">else</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[</span><span style="color:#57c7ff">0xF</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;=</span> <span style="color:#57c7ff">0xFF</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0006</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># 8XY6: Shift the value of register X right by 1. Set VF to the least significant bit of X before the shift</span>
</span></span><span style="display:flex;"><span>            last_bit <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x01</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">if</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>shift_quirk<span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&gt;&gt;=</span> <span style="color:#56b6c2">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">else</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00F0</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">4</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[</span><span style="color:#57c7ff">0xF</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> last_bit
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0007</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># 8XY7: Set register X to the value of register Y minus register X. Set VF to 0 if there is a borrow, 1 otherwise</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00F0</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">4</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span><span style="color:#56b6c2">)</span> \
</span></span><span style="display:flex;"><span>                                                        <span style="color:#bc74c4">-</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span><span style="color:#56b6c2">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">if</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&lt;</span> <span style="color:#56b6c2">0</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[</span><span style="color:#57c7ff">0xF</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">0</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">else</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[</span><span style="color:#57c7ff">0xF</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;=</span> <span style="color:#57c7ff">0xFF</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x000E</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># 8XYE: Shift the value of register X left by 1. Set VF to the most significant bit of X before the shift</span>
</span></span><span style="display:flex;"><span>            first_bit <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x80</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">7</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">if</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>shift_quirk<span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">((</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&lt;&lt;</span> <span style="color:#56b6c2">1</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">else</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">((</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00F0</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">4</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&lt;&lt;</span> <span style="color:#56b6c2">1</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[</span><span style="color:#57c7ff">0xF</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> first_bit
</span></span></code></pre></div><p>The next few instructions are pretty self-explanatory and use the same ideas we&rsquo;ve already seen.</p>
<h3 id="9xy0"><code>9XY0</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x9000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># 9XY0: Skip the next instruction if register X does not equal register Y</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">if</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">!=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00F0</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">4</span><span style="color:#56b6c2">]:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>program_counter <span style="color:#bc74c4">+=</span> <span style="color:#56b6c2">2</span>
</span></span></code></pre></div><h3 id="annn"><code>ANNN</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0xA000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># ANNN: Set the index register to the address NNN</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register <span style="color:#bc74c4">=</span> instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0FFF</span>
</span></span></code></pre></div><h3 id="bnnn"><code>BNNN</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0xB000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># BNNN: Jump to the address NNN plus the value of register 0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>program_counter <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0FFF</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">+</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[</span><span style="color:#56b6c2">0</span><span style="color:#56b6c2">]</span>
</span></span></code></pre></div><h3 id="cxnn"><code>CXNN</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0xC000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># CXNN: Set register X to a random number AND NN</span>
</span></span><span style="display:flex;"><span>    random<span style="color:#bc74c4">.</span>seed<span style="color:#56b6c2">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> random<span style="color:#bc74c4">.</span>randint<span style="color:#56b6c2">(</span><span style="color:#56b6c2">0</span><span style="color:#56b6c2">,</span> <span style="color:#56b6c2">255</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#56b6c2">(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00FF</span><span style="color:#56b6c2">)</span>
</span></span></code></pre></div><p>Alright, here is the instruction that actually draws to the screen, and it&rsquo;s by far the most complicated instruction to implement. Getting this to run properly will also allow you to start using test ROMs, so you can check if you&rsquo;ve handled all the quirks of the system properly.</p>
<p>What <code>DXYN</code> does is draw a sprite at the point with x-coordinate determined by the value of register <code>X</code>, and y-coordinate determined by the value of register <code>Y</code>. To do so, we use <code>N</code> bytes of sprite data from the location pointed to by the index pointer.</p>
<h3 id="dxyn"><code>DXYN</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0xD000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># DXYN: Draw a sprite at coordinate VX, VY using N bytes of sprite data starting at the address stored in the index register</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3e4460"># If any set pixels are unset, set VF to 1. Otherwise, set VF to 0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[</span><span style="color:#57c7ff">0xF</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">0</span>
</span></span><span style="display:flex;"><span>    x <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span>
</span></span><span style="display:flex;"><span>    y <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00F0</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">4</span><span style="color:#56b6c2">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">for</span> i <span style="color:#bc74c4">in</span> <span style="color:#7fbaf5">range</span><span style="color:#56b6c2">(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x000F</span><span style="color:#56b6c2">):</span>
</span></span><span style="display:flex;"><span>        sprite_byte <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>memory<span style="color:#56b6c2">[</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register <span style="color:#bc74c4">+</span> i<span style="color:#56b6c2">]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">for</span> j <span style="color:#bc74c4">in</span> <span style="color:#7fbaf5">range</span><span style="color:#56b6c2">(</span><span style="color:#56b6c2">8</span><span style="color:#56b6c2">):</span>
</span></span><span style="display:flex;"><span>            pixel <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">(</span>sprite_byte <span style="color:#bc74c4">&amp;</span> <span style="color:#56b6c2">(</span><span style="color:#57c7ff">0x80</span> <span style="color:#bc74c4">&gt;&gt;</span> j<span style="color:#56b6c2">))</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">(</span><span style="color:#56b6c2">7</span> <span style="color:#bc74c4">-</span> j<span style="color:#56b6c2">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">if</span> pixel <span style="color:#bc74c4">==</span> <span style="color:#56b6c2">1</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">if</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>screen<span style="color:#56b6c2">[(</span>x <span style="color:#bc74c4">+</span> j <span style="color:#bc74c4">+</span> <span style="color:#56b6c2">((</span>y <span style="color:#bc74c4">+</span> i<span style="color:#56b6c2">)</span> <span style="color:#bc74c4">*</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>screen_width<span style="color:#56b6c2">))</span> <span style="color:#bc74c4">%</span> <span style="color:#7fbaf5">len</span><span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>screen<span style="color:#56b6c2">)]</span> <span style="color:#bc74c4">==</span> <span style="color:#56b6c2">1</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[</span><span style="color:#57c7ff">0xF</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">1</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>screen<span style="color:#56b6c2">[(</span>x <span style="color:#bc74c4">+</span> j <span style="color:#bc74c4">+</span> <span style="color:#56b6c2">((</span>y <span style="color:#bc74c4">+</span> i<span style="color:#56b6c2">)</span> <span style="color:#bc74c4">*</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>screen_width<span style="color:#56b6c2">))</span> <span style="color:#bc74c4">%</span> <span style="color:#7fbaf5">len</span><span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>screen<span style="color:#56b6c2">)]</span> <span style="color:#bc74c4">^=</span> <span style="color:#56b6c2">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>draw_flag <span style="color:#bc74c4">=</span> <span style="color:#cf5967;background-color:#43454f">True</span>
</span></span></code></pre></div><p>For these two instructions, we access the <code>keys</code> array that holds whether any of the 16 keys have been pressed in this frame. You should check (i.e. poll) these events every frame in your main program loop.</p>
<h3 id="ex9e-and-exa1"><code>EX9E</code> and <code>EXA1</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0xE000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">match</span> instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00FF</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x009E</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># EX9E: Skip the next instruction if the key stored in register X is pressed</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">if</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>keys<span style="color:#56b6c2">[</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]]</span> <span style="color:#bc74c4">!=</span> <span style="color:#56b6c2">0</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>program_counter <span style="color:#bc74c4">+=</span> <span style="color:#56b6c2">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x00A1</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># EXA1: Skip the next instruction if the key stored in register X is not pressed</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">if</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>keys<span style="color:#56b6c2">[</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]]</span> <span style="color:#bc74c4">==</span> <span style="color:#56b6c2">0</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>program_counter <span style="color:#bc74c4">+=</span> <span style="color:#56b6c2">2</span>
</span></span></code></pre></div><h3 id="fx07---fx65"><code>FX07</code> - <code>FX65</code></h3>
<p>These are a bunch of miscellaneous instructions. Make sure you remember to mask values (i.e. <code>&amp; 0xFFFF</code> or <code>&amp; 0xFF</code>) anywhere where there could be a value that goes above either 16-bits or 8-bits, respectively.</p>
<div class="highlight"><pre tabindex="0" style="color:#c9c9c9;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0xF000</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#7fbaf5">match</span> instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x00FF</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0007</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># FX07: Set register X to the value of the delay timer</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>delay_timer
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x000A</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># FX0A: Wait for a key press and store the result in register X</span>
</span></span><span style="display:flex;"><span>            key_pressed <span style="color:#bc74c4">=</span> <span style="color:#cf5967;background-color:#43454f">False</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">for</span> i <span style="color:#bc74c4">in</span> <span style="color:#7fbaf5">range</span><span style="color:#56b6c2">(</span><span style="color:#56b6c2">16</span><span style="color:#56b6c2">):</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">if</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>keys<span style="color:#56b6c2">[</span>i<span style="color:#56b6c2">]</span> <span style="color:#bc74c4">!=</span> <span style="color:#56b6c2">0</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> i
</span></span><span style="display:flex;"><span>                    key_pressed <span style="color:#bc74c4">=</span> <span style="color:#cf5967;background-color:#43454f">True</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#7fbaf5">break</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">if</span> <span style="color:#bc74c4">not</span> key_pressed<span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>program_counter <span style="color:#bc74c4">-=</span> <span style="color:#56b6c2">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0015</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># FX15: Set the delay timer to the value of register X</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>delay_timer <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0018</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># FX18: Set the sound timer to the value of register X</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>sound_timer <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x001E</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># FX1E: Add the value of register X to the index register</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">((</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFFF</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">+</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">])</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFFFF</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0029</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># FX29: Set the index register to the location of the sprite for the character in register X</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">*</span> <span style="color:#56b6c2">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0033</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># FX33: Store the binary-coded decimal representation of the value of register X at the addresses I, I+1, and I+2</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>memory<span style="color:#56b6c2">[</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register<span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">//</span> <span style="color:#56b6c2">100</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>memory<span style="color:#56b6c2">[</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register <span style="color:#bc74c4">+</span> <span style="color:#56b6c2">1</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">//</span> <span style="color:#56b6c2">10</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">%</span> <span style="color:#56b6c2">10</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>memory<span style="color:#56b6c2">[</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register <span style="color:#bc74c4">+</span> <span style="color:#56b6c2">2</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[(</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">%</span> <span style="color:#56b6c2">10</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0055</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># FX55: Store the values of registers V0 to VX in memory starting at address I</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">for</span> i <span style="color:#bc74c4">in</span> <span style="color:#7fbaf5">range</span><span style="color:#56b6c2">(((</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">+</span> <span style="color:#56b6c2">1</span><span style="color:#56b6c2">):</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>memory<span style="color:#56b6c2">[(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register <span style="color:#bc74c4">+</span> i<span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFFFF</span><span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[</span>i<span style="color:#56b6c2">]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFFFF</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">+</span> <span style="color:#56b6c2">((((</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">+</span> <span style="color:#56b6c2">1</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFFFF</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFFFF</span>
</span></span><span style="display:flex;"><span>        <span style="color:#7fbaf5">case</span> <span style="color:#57c7ff">0x0065</span><span style="color:#56b6c2">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#3e4460"># FX65: Fill registers V0 to VX with values from memory starting at address I</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">for</span> i <span style="color:#bc74c4">in</span> <span style="color:#7fbaf5">range</span><span style="color:#56b6c2">(((</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">+</span> <span style="color:#56b6c2">1</span><span style="color:#56b6c2">):</span>
</span></span><span style="display:flex;"><span>                <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>registers<span style="color:#56b6c2">[</span>i<span style="color:#56b6c2">]</span> <span style="color:#bc74c4">=</span> <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>memory<span style="color:#56b6c2">[</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register <span style="color:#bc74c4">+</span> i<span style="color:#56b6c2">]</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFF</span>
</span></span><span style="display:flex;"><span>            <span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register <span style="color:#bc74c4">=</span> <span style="color:#56b6c2">(</span><span style="color:#7fbaf5">self</span><span style="color:#bc74c4">.</span>index_register <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFFFF</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">+</span> <span style="color:#56b6c2">((((</span>instruction <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0x0F00</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&gt;&gt;</span> <span style="color:#56b6c2">8</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">+</span> <span style="color:#56b6c2">1</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFFFF</span><span style="color:#56b6c2">)</span> <span style="color:#bc74c4">&amp;</span> <span style="color:#57c7ff">0xFFFF</span>
</span></span></code></pre></div><h2 id="super-chip-additions">SUPER-CHIP Additions</h2>
<p>The SUPER-CHIP, an extension of the original CHIP-8, introduced several new features and instructions. Here are some of the key additions:</p>
<ol>
<li>
<p>Higher Resolution: SUPER-CHIP added a high-resolution mode of 128x64 pixels, in addition to the original 64x32 mode.</p>
</li>
<li>
<p>Scrolling: New instructions were added to scroll the display in different directions.</p>
</li>
<li>
<p>Extended Sprite Drawing: SUPER-CHIP allowed for 16x16 pixel sprites in addition to the original 8x8 sprites.</p>
</li>
<li>
<p>New Instructions:</p>
<ul>
<li>00CN: Scroll display N pixels down</li>
<li>00FB: Scroll display 4 pixels right</li>
<li>00FC: Scroll display 4 pixels left</li>
<li>00FD: Exit CHIP-8 interpreter</li>
<li>00FE: Disable high-resolution mode</li>
<li>00FF: Enable high-resolution mode</li>
<li>DXY0: Draw 16x16 sprite</li>
<li>FX75: Store V0..VX in RPL user flags (X &lt;= 7)</li>
<li>FX85: Read V0..VX from RPL user flags (X &lt;= 7)</li>
</ul>
</li>
</ol>
<p>These additions expanded the capabilities of CHIP-8, allowing for more complex graphics and interactions in SUPER-CHIP programs.</p>
<h2 id="xo-chip-additions">XO-CHIP Additions</h2>
<h1 id="concluding-remarks">Concluding Remarks</h1>

  </div>
</div>
<div class="container has-text-centered">
    
</div>

<div class="container has-text-centered">
  
</div>

<section class="section py-0">
  <div class="container has-text-centered">
    <p></p>
  </div>
</section>

